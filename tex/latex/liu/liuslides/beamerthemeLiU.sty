%% beamerthemeLiU.sty
%% Copyright 2015 Clas Veibäck
%
% This work may be distributed and/or modified under the
% conditions of the LaTeX Project Public License, either version 1.3
% of this license or (at your option) any later version.
% The latest version of this license is in
%   http://www.latex-project.org/lppl.txt
% and version 1.3 or later is part of all distributions of LaTeX
% version 2005/12/01 or later.
%
% This work has the LPPL maintenance status `maintained'.
% 
% The Current Maintainer of this work is Clas Veibäck.
%
% This work consists of the files beamer*themeLiU.sty
%
%% THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
%% IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
%% FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
%% AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
%% LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
%% OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
%% SOFTWARE.

\mode<presentation>

%%
%% Packages
%%
\usepackage{etex}
\usepackage{multicol}
\usepackage{environ}

%%
%%	Read Options
%%
\DeclareOptionBeamer{titlecolor}{\PassOptionsToPackage{titlecolor=#1}{beamercolorthemeLiU}}
\ProcessOptionsBeamer
\DeclareOptionBeamer{outlinecolor}{\PassOptionsToPackage{outlinecolor=#1}{beamercolorthemeLiU}}
\ProcessOptionsBeamer
\DeclareOptionBeamer{endcolor}{\PassOptionsToPackage{endcolor=#1}{beamercolorthemeLiU}}
\ProcessOptionsBeamer
\DeclareOptionBeamer{blockcolor}{\PassOptionsToPackage{blockcolor=#1}{beamercolorthemeLiU}}
\ProcessOptionsBeamer
\DeclareOptionBeamer{complementary}{\PassOptionsToPackage{complementary=#1}{beamercolorthemeLiU}}
\ProcessOptionsBeamer
\DeclareOptionBeamer{highcontrast}{\PassOptionsToPackage{highcontrast}{beamercolorthemeLiU}}
\ProcessOptionsBeamer
\DeclareOptionBeamer{superhighcontrast}{\PassOptionsToPackage{superhighcontrast}{beamercolorthemeLiU}}
\ProcessOptionsBeamer
\DeclareOptionBeamer{homepage}{\PassOptionsToPackage{homepage}{beamercolorthemeLiU}}
\ProcessOptionsBeamer
\DeclareOptionBeamer{shadow}{\PassOptionsToPackage{shadow}{beamerinnerthemeLiU}}
\ProcessOptionsBeamer
\DeclareOptionBeamer{rounded}{\PassOptionsToPackage{rounded}{beamerinnerthemeLiU}}
\ProcessOptionsBeamer
\DeclareOptionBeamer{font}{\PassOptionsToPackage{font=#1}{beamerfontthemeLiU}}
\ProcessOptionsBeamer
\DeclareOptionBeamer{navigation}{\PassOptionsToPackage{navigation}{beamerouterthemeLiU}}
\ProcessOptionsBeamer
\DeclareOptionBeamer{noheader}{\PassOptionsToPackage{noheader}{beamerouterthemeLiU}}
\ProcessOptionsBeamer
\DeclareOptionBeamer{minimalheader}{\PassOptionsToPackage{minimalheader}{beamerouterthemeLiU}}
\ProcessOptionsBeamer
\DeclareOptionBeamer{noheadertitle}{\PassOptionsToPackage{noheadertitle}{beamerouterthemeLiU}}
\ProcessOptionsBeamer
\DeclareOptionBeamer{noheaderauthor}{\PassOptionsToPackage{noheaderauthor}{beamerouterthemeLiU}}
\ProcessOptionsBeamer
\DeclareOptionBeamer{noheaderdate}{\PassOptionsToPackage{noheaderdate}{beamerouterthemeLiU}}
\ProcessOptionsBeamer
\DeclareOptionBeamer{noheadernumber}{\PassOptionsToPackage{noheadernumber}{beamerouterthemeLiU}}
\ProcessOptionsBeamer
\DeclareOptionBeamer{nofooter}{\PassOptionsToPackage{nofooter}{beamerouterthemeLiU}}
\ProcessOptionsBeamer
\DeclareOptionBeamer{totalframes}{\PassOptionsToPackage{totalframes}{beamerouterthemeLiU}}
\ProcessOptionsBeamer
\DeclareOptionBeamer{tightpage}{\PassOptionsToPackage{tightpage}{beamerouterthemeLiU}}
\ProcessOptionsBeamer
\DeclareOptionBeamer{footerimage}{\PassOptionsToPackage{footerimage}{beamerouterthemeLiU}\PassOptionsToPackage{footerimage}{beamercolorthemeLiU}}
\ProcessOptionsBeamer

\newif\ifLiU@titlepageimage\LiU@titlepageimagefalse%% Option to add image to title page
\DeclareOptionBeamer{titlepageimage}{\LiU@titlepageimagetrue\PassOptionsToPackage{titlepageimage}{beamercolorthemeLiU}}
\ProcessOptionsBeamer

\newif\ifLiU@endpage\LiU@endpagetrue%% Option for removing end page.
\DeclareOptionBeamer{noendpage}{\LiU@endpagefalse}
\ProcessOptionsBeamer

\newif\ifLiU@outline\LiU@outlinetrue%% Option for removing outline.
\DeclareOptionBeamer{nooutline}{\LiU@outlinefalse}
\ProcessOptionsBeamer

\newif\ifLiU@outlinecolumns\LiU@outlinecolumnsfalse%% Option for outline columns.
\DeclareOptionBeamer{outlinecolumns}{\LiU@outlinecolumnstrue}
\ProcessOptionsBeamer

\newif\ifLiU@institute\LiU@institutefalse%% Option for showing institute on title page.
\DeclareOptionBeamer{showinstitute}{\LiU@institutetrue}
\ProcessOptionsBeamer

%%
%% Set themes
%%
\useinnertheme{LiU}
\useoutertheme{LiU}
\usecolortheme{LiU}
\usefonttheme{LiU}

%%
%% LIU FRAME
%%
\newdimen\LiU@titlemargin
\LiU@titlemargin = 25mm

\newdimen\LiU@logobottom
\LiU@logobottom = 4mm

\newdimen\LiU@titlewidth
\LiU@titlewidth = \paperwidth
\advance \LiU@titlewidth by-2\LiU@titlemargin

\newdimen\LiU@logomargin
\LiU@logomargin = \LiU@titlemargin
\advance \LiU@logomargin by-0.5\LiU@logo@large@width%% According to specification

\NewEnviron{LiUframe}[1][titlepage]{% Option is beamer color
	\begingroup%
		\setbeamertemplate{navigation symbols}{}%
		\begin{frame}[plain]%
			\begin{beamercolorbox}[wd=\paperwidth,ht=\paperheight,left]{#1}%
				\begin{center}%
					\begin{minipage}{\LiUframewidth}%
						\BODY%
					\end{minipage}%
				\end{center}%
				\hskip\LiUframelogomargin%
				\vskip0mm%
				\begin{minipage}{\paperwidth}%
					\hskip\LiUframelogomargin \insertLargeLogo{#1}  \hfill \ifLiU@titlepageimage  \insertLargeImage{#1} \hspace{\LiUframelogomargin} \fi%
				\end{minipage}%
				\vskip\LiUframelogobottom%
			\end{beamercolorbox}%
		\end{frame}%
	\endgroup%
}

%
% TITLE PAGE
%
\def\maketitle{%
	\ifbeamer@inframe%
		\PackageWarning{LiU}{%
			\begin{verbatim}%
				\maketitle must be called outside frame.
			\end{verbatim}%
		}%
	\else%
		\begin{LiUframe}[titlepage]%
			\titlepage%
		\end{LiUframe}%
	\fi%
}%

\newdimen\LiU@titleposition
\LiU@titleposition = 25mm

\defbeamertemplate*{title page}{LiU}[1][]{%	
	\setcounter{framenumber}{0}%
	\raggedright\usebeamerfont{title}\inserttitle\par%
	\ifx\insertsubtitle\@empty\else%
		{\usebeamerfont{subtitle}\insertsubtitle\par}%
	\fi%
	\vskip3mm%
	\begin{beamercolorbox}[wd=\LiU@titlewidth,left]{author}%
		\raggedright\usebeamerfont{author in title}\insertauthor%
	\end{beamercolorbox}%
	\ifx\insertinstitute\@empty\else%
	\ifLiU@institute%
		\vspace{3mm}
		\begin{beamercolorbox}[wd=\LiU@titlewidth,left]{author}%
			\raggedright\usebeamerfont{institute in title}\insertinstitute%
		\end{beamercolorbox}%
		\vspace{-10mm}%
		\fi%
	\fi%
	\vspace{\LiU@titleposition}%
}

%
% END PAGE
%
\def\makeend{%
	\ifbeamer@inframe%
		\PackageWarning{LiU}{%
			\begin{verbatim}%
				\makeend must be called outside frame.
			\end{verbatim}%
		}%
	\else%
		\begin{LiUframe}[endpage]%
			\endpage%
		\end{LiUframe}%
	\fi%
}

\newdimen\LiU@textposition
\LiU@textposition = 25mm

\defbeamertemplate*{end page}{LiU}[1][]{%
	\begin{center}%
		\ifx\LiU@finaltext\LiU@empty%
			\usebeamerfont{endauthor}\insertauthor\par%
		\else%
			\usebeamerfont{endtext}\LiU@finaltext\par%
		\fi%
	\end{center}%
	\begin{beamercolorbox}[center,#1]{author}%
		\usebeamerfont{endlink}\href{www.liu.se}{www.liu.se}%
	\end{beamercolorbox}%
	\vspace{\LiU@textposition}%
}

\def\endpage{\usebeamertemplate*{end page}}

\ifLiU@endpage
  \AtEndDocument{\makeend}
\fi

%
% OUTLINE PAGE
%

\newcommand{\makeoutline}[1][]{%
	\begingroup%
		\setbeamertemplate{outline page}[LiU][#1]%
		\ifbeamer@inframe%
			\outlinepage%
		\else%
			\begin{LiUframe}[outlinepage]%
				\outlinepage%
			\end{LiUframe}%
		\fi%
	\endgroup%
}

\newdimen\LiU@outlineposition
\LiU@outlineposition = 10mm

\defbeamertemplate*{outline page}{LiU}[1][]{%
	\begin{minipage}[c][10em]{\LiU@titlewidth}%
		\begin{beamercolorbox}[wd=\LiU@titlewidth,left]{outlinepage}%
			\ifLiU@outlinecolumns%
				\begin{multicols}{2}%
					\tableofcontents[#1]%
				\end{multicols}%
			\else%
				\tableofcontents[#1]%
			\fi%
		\end{beamercolorbox}%
	\end{minipage}%
	\vspace{\LiU@outlineposition}%
}

\def\outlinepage{\usebeamertemplate*{outline page}}

\ifLiU@outline
	\AtBeginSection[]{\makeoutline[currentsection]}
\fi

%%
%% Macro Export
%%
\def\LiUframewidth{\LiU@titlewidth}
\def\LiUframemargin{\LiU@titlemargin}
\def\LiUframelogomargin{\LiU@logomargin}
\def\LiUframelogobottom{\LiU@logobottom}
\newcommand{\finaltext}[1]{\gdef\LiU@finaltext{#1}}

\mode<all>
